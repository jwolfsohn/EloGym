<div class="max-w-4xl mx-auto px-4 pt-8 pb-32">
  <div class="flex items-center justify-between mb-8 relative">
    <h1 class="text-4xl font-display text-electric text-center tracking-wider uppercase w-full">Matchmaking</h1>
    <%= link_to "PROFILE", "#", class: "absolute right-0 top-1 btn-primary bg-midnight-card border border-white/20 px-4 py-1.5 rounded text-xs font-black tracking-widest uppercase text-white hover:bg-white/5 transition-colors" %>
  </div>

  <div class="bg-midnight-card border border-white/5 rounded-lg p-6 mb-8">
    <h2 class="text-2xl font-display text-electric mb-4 tracking-wide uppercase">Find Users</h2>

    <%= form_with url: battles_path, method: :get, class: "flex gap-4 mb-4", local: true do |f| %>
      <%= f.text_field :query, placeholder: "Search by username", value: params[:query], class: "flex-1 bg-gray-900 border border-electric/30 rounded px-4 py-2 text-black font-bold placeholder-gray-600 focus:border-electric focus:ring-0" %>
      <%= f.submit "SEARCH", name: nil, class: "btn-primary bg-electric text-black px-8 py-2 rounded text-sm font-black tracking-widest uppercase hover:bg-electric/90 transition-colors cursor-pointer" %>
    <% end %>

    <% if params[:query].present? %>
      <div class="mt-4">
        <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-2">Search Results</h3>
        <% if @search_results.any? %>
          <div class="space-y-2">
            <% @search_results.each do |user| %>
              <div class="flex items-center justify-between bg-midnight-base p-3 rounded border border-white/5">
                <div class="flex items-center gap-3">
                  <span class="font-bold text-black"><%= user.username %></span>
                  <span class="text-neon-lime font-display text-xl"><%= user.rank %></span>
                  <span class="text-gray-400 text-sm"><%= user.total_points %> pts</span>
                </div>
                <% if @friends.include?(user) %>
                  <span class="bg-gray-700 text-gray-400 px-6 py-1.5 rounded text-xs font-black tracking-widest uppercase">FRIENDS</span>
                <% else %>
                  <%= button_to "ADD FRIEND", friends_path(friend_id: user.id), method: :post, class: "bg-neon-lime text-black px-6 py-1.5 rounded text-xs font-black tracking-widest uppercase hover:bg-neon-lime/90 transition-colors" %>
                <% end %>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-gray-500 text-sm">No users found matching "<%= params[:query] %>"</p>
        <% end %>
      </div>
    <% end %>
  </div>

  <div class="bg-midnight-card border border-white/5 rounded-lg p-6 mb-8">
    <h2 class="text-2xl font-display text-electric mb-4 tracking-wide uppercase">Your Friends</h2>
    
    <% if @friends.any? %>
      <div class="space-y-2">
        <% @friends.each do |friend| %>
          <div class="flex items-center justify-between bg-midnight-base p-3 rounded border border-white/5">
            <div class="flex items-center gap-3">
              <span class="font-bold text-black"><%= friend.username %></span>
              <span class="text-neon-lime font-display text-xl"><%= friend.rank %></span>
            </div>
            <%= link_to "BATTLE", new_battle_path(opponent_id: friend.id), class: "bg-electric text-black px-6 py-1.5 rounded text-xs font-black tracking-widest uppercase hover:bg-electric/90 transition-colors inline-block" %>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-gray-500 text-sm">No friends added yet.</p>
    <% end %>
  </div>

  <div class="mb-4">
    <h2 class="text-2xl font-display text-electric tracking-wide uppercase">Pending Battles</h2>
  </div>
  
  <% if @pending_battles.any? %>
    <div class="space-y-3">
      <% @pending_battles.each do |battle| %>
        <div class="bg-midnight-card border border-white/5 rounded-lg p-4">
          <div class="flex items-center justify-between">
            <div>
              <% if battle.challenger == current_user %>
                <p class="text-white font-bold">Challenge sent to <span class="text-black font-bold"><%= battle.opponent.username %></span></p>
                <p class="text-gray-400 text-sm mt-1">
                  <% if battle.opponent_stats_submitted? %>
                    Waiting for results...
                  <% else %>
                    Waiting for <%= battle.opponent.username %> to respond
                  <% end %>
                </p>
              <% else %>
                <p class="text-white font-bold"><span class="text-black font-bold"><%= battle.challenger.username %></span> challenged you!</p>
                <p class="text-gray-400 text-sm mt-1">Submit your stats to complete the battle</p>
              <% end %>
            </div>
            <div>
              <% if battle.opponent == current_user && !battle.opponent_stats_submitted? %>
                <%= link_to "RESPOND", respond_battle_path(battle), class: "bg-neon-lime text-black px-6 py-2 rounded text-xs font-black tracking-widest uppercase hover:bg-neon-lime/90 transition-colors" %>
              <% elsif battle.challenger == current_user && !battle.challenger_stats_submitted? %>
                <span class="text-gray-500 text-xs">Pending</span>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="bg-midnight-card border border-white/5 rounded-lg p-6 min-h-[100px] flex items-center justify-center">
      <p class="text-gray-500 text-sm">No pending battles.</p>
    </div>
  <% end %>
</div>

  <div class="mt-12 mb-4">
    <h2 class="text-2xl font-display text-electric tracking-wide uppercase">Battle History</h2>
  </div>

  <% if @completed_battles.any? %>
    <div class="space-y-3">
      <% @completed_battles.each do |battle| %>
        <div class="bg-midnight-card border border-white/5 rounded-lg p-4 hover:border-electric/30 transition-colors">
          <%= link_to battle_path(battle), class: "flex items-center justify-between" do %>
            <div class="flex items-center gap-4">
              <div class="text-center">
                <span class="font-bold text-black block"><%= battle.challenger.username %></span>
                <span class="text-neon-lime font-display text-sm"><%= battle.challenger.rank %></span>
              </div>

              <div class="text-gray-400 font-bold">VS</div>

              <div class="text-center">
                <span class="font-bold text-black block"><%= battle.opponent.username %></span>
                <span class="text-neon-lime font-display text-sm"><%= battle.opponent.rank %></span>
              </div>
              
              <div class="ml-4">
                <% if battle.winner %>
                  <% if battle.winner == current_user %>
                    <span class="bg-neon-lime/20 text-neon-lime px-4 py-1 rounded text-xs font-black uppercase">Victory</span>
                  <% else %>
                    <span class="bg-energy-orange/20 text-energy-orange px-4 py-1 rounded text-xs font-black uppercase">Defeat</span>
                  <% end %>
                <% else %>
                  <span class="bg-gray-700/20 text-gray-400 px-4 py-1 rounded text-xs font-black uppercase">Draw</span>
                <% end %>
              </div>
            </div>
            
            <div class="text-right">
              <p class="text-gray-400 text-xs"><%= battle.updated_at.strftime("%b %d, %Y") %></p>
              <p class="text-electric text-xs font-bold mt-1">View Details â†’</p>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="bg-midnight-card border border-white/5 rounded-lg p-6 text-center">
      <p class="text-gray-500 text-sm">No battle history yet. Challenge a friend to get started!</p>
    </div>
  <% end %>
</div>
